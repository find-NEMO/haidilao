name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Run a multi-line script
      run: |
        #!/usr/bin/env sh

        # abort on errors
        set -e

        cd haidilao_app
        npm install @vue/cli
        # build
        npm run build
    - name: copy files
      uses: appleboy/scp-action@master
      with:
        host: 121.36.9.253
        username: root
        password: ${{secrets.hwp}}
        port: 22
        source: "haidilao_app/dist/*"
        target: "haidilao"
        rm: true
    - name: server deploy
      uses: easingthemes/ssh-deploy@v2.0.7
      with:
        # Private Key
        SSH_PRIVATE_KEY: ${{secrets.hwk}}
        # Remote host
        REMOTE_HOST: 121.36.9.253
        # Remote user
        REMOTE_USER: root
        # Source directory
        SOURCE: "haidilao_sever/" 
        # Target directory
        TARGET: "/root/"
